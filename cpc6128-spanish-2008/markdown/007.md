# Capítulo 7 - Para su referencia

Este capítulo contiene la mayor parte de la información que usted pueda
necesitar para aprender a manejar el ordenador.

Temas tratados:

\* Posiciones del cursor y códigos de control

\* Interrupciones

\* Caracteres ASCII y caracteres gráficos

\* Esquemas del teclado

\* Sonidos

\* Mensajes de error

\* Palabras de error

\* Palabras reservadas de BASIC

\* Plantillas

\* Conexiones

\* Impresoras

\* Joysticks

\* Organización de los discos

\* Ampliaciones del sistema residentes (RSX)

\* Memoria

\* Emulador de consola de CP/M Plus

\* Juego de caracteres de CP/M Plus

Para más completa información sobre BASIC y el firmware del CPC6128,
consúltense las publicaciones SOFT967 y SOFT968, respectivamente.

## Parte 1: Posiciones del cursor y códigos ampliados de control en BASIC

En ciertas aplicaciones el cursor puede encontrarse fuera de la ventana
de texto. Algunas operaciones fuerzan al cursor a ocupar una posición
permitida antes de poder ser llevadas a cabo. Son las siguientes:

1.  Escribir un carácter.

```{=html}
<!-- -->
```
1.  Exhibir el signo del cursor (el rectángulo).

2.  Obedecer los códigos de control señalados con un asterisco en la
    tabla siguiente.

El proceso de forzar el cursor a ocupar una posición permitida consiste
en lo siguiente:

1.  Si el cursor está a la derecha del borde derecho de la ventana,
    salta al extremo izquierdo de la línea siguiente.

```{=html}
<!-- -->
```
1.  Si el cursor está a la izquierda del borde izquierdo de la ventana,
    salta al extremo derecho de la línea anterior.

2.  Si el cursor está por encima del borde superior, el contenido de la
    ventana se desplaza una línea hacia abajo y el cursor aparece en la
    primera línea.

3.  Si el cursor está por debajo del borde inferior, el contenido de la
    ventana se desplaza una línea hacia arriba y el cursor aparece en la
    última línea.

Las comprobaciones y operaciones se realizan en el orden de la lista
anterior. Las posiciones ilegales del cursor pueden ser cero o
negativas, es decir, a la izquierda y por encima de la ventana.

Los códigos del margen 0 a 31 no producen ningún símbolo cuando se los
envía a la pantalla, sino que son interpretados como códigos de control
(y deben ser utilizados con cuidado). Algunos de ellos alteran el
significado de uno o varios de los códigos siguientes, que hacen las
funciones de parámetros del código original.

Si se envía un código de control a la pantalla gráfica, su efecto es
dibujar un símbolo relacionado con la función que tendría si se lo
generase mediante el teclado (v. g., &07'13EL\': \[CONTROL\]G). Ejercerá
su función de control si se lo envía a la pantalla mediante:

PRINT CHR\$(&07) o bien PRINT \"Ω\"

donde el símbolo del \"timbre\" se obtiene pulsando \[CONTROL\]G en el
momento de teclear la instrucción PRINT.

Los códigos señalados con \* en la lista siguiente fuerzan al cursor a
ocupar una posición permitida en la ventana antes de ser obedecidos.
Para cada código se da el número, en hexadecimal y en decimal, y la
descripción de su función.

### Códigos de control en BASIC

+-------+--------+----------+-----------------------------------------+
| Valor | Nombre | P        | Significado                             |
|       |        | arámetro |                                         |
+=======+========+==========+=========================================+
| &00 0 | NUL    |          | Sin efecto. Se lo ignora.               |
+-------+--------+----------+-----------------------------------------+
| &01   | SOH    | 0 a 255  | Escribe el símbolo correspondiente al   |
|       |        |          | valor del parámetro, lo que permite     |
|       |        |          | exhibir los símbolos del 0 al 31.       |
+-------+--------+----------+-----------------------------------------+
| &02 2 | STX    |          | Hace invisible el cursor de texto.      |
|       |        |          | Equivale a la orden CURSOR con el       |
|       |        |          | parámetro (conmutador de usuario) igual |
|       |        |          | a 0.                                    |
+-------+--------+----------+-----------------------------------------+
| &03 3 | ETX    |          | Hace visible el cursor de texto.        |
|       |        |          | Equivale a la orden CURSOR con el       |
|       |        |          | parámetro (conmutador de usuario) igual |
|       |        |          | a 1. Nótese que para visualizar el      |
|       |        |          | cursor desde dentro de un programa de   |
|       |        |          | BASIC (aparte de la situación en que    |
|       |        |          | BASIC está esperando una entrada por el |
|       |        |          | teclado) es necesario ejecutar una      |
|       |        |          | orden CURSOR con el parámetro           |
|       |        |          | (conmutador del sistema) igual a 1.     |
+-------+--------+----------+-----------------------------------------+
| &04 4 | EOT    | 0 a 2    | Establece el modo de pantalla. El       |
|       |        |          | parámetro se toma MOD 4. Equivale a la  |
|       |        |          | orden MODE.                             |
+-------+--------+----------+-----------------------------------------+
| &05 5 | ENQ    | 0 a 255  | Envía a la posición del cursor gráfico  |
|       |        |          | el carácter correspondiente al valor    |
|       |        |          | del parámetro.                          |
+-------+--------+----------+-----------------------------------------+
| &06 6 | ACK    |          | Habilita la pantalla de texto. (Véase   |
|       |        |          | &15 NAK.)                               |
+-------+--------+----------+-----------------------------------------+
| &07 7 | BEL    |          | Produce un pitido. Obsérvese que este   |
|       |        |          | código borra las colas de sonido.       |
+-------+--------+----------+-----------------------------------------+
| &08 8 | \*BS   |          | Hace retroceder el cursor una posición. |
+-------+--------+----------+-----------------------------------------+
| &09 9 | \*TAB  |          | Hace avanzar el cursor una posición.    |
+-------+--------+----------+-----------------------------------------+
| &0A   | \*LF   |          | Hace bajar el cursor una línea.         |
| 10    |        |          |                                         |
+-------+--------+----------+-----------------------------------------+
| &0B   | \*VT   |          | Hace subir el cursor una línea.         |
| 11    |        |          |                                         |
+-------+--------+----------+-----------------------------------------+
| &0C   | FF     |          | Borra la ventana de texto y lleva el    |
| 12    |        |          | cursor al extremo superior izquierdo.   |
|       |        |          | Equivale a la orden CLS.                |
+-------+--------+----------+-----------------------------------------+
| &0D   | \*CR   |          | Lleva el cursor al extremo izquierdo de |
| 13    |        |          | la línea actual.                        |
+-------+--------+----------+-----------------------------------------+
| &0E   | SO     | 0 a 15   | Establece la tinta asignada al papel.   |
| 14    |        |          | El parámetro se toma MOD 16. Equivale a |
|       |        |          | la orden PAPER.                         |
+-------+--------+----------+-----------------------------------------+
| &0F   | SI     | 0 a 15   | Establece la tinta asignada a la pluma. |
| 15    |        |          | El parámetro se toma MOD 16. Equivale a |
|       |        |          | la orden PEN.                           |
+-------+--------+----------+-----------------------------------------+
| &10   | \*DLE  |          | Borra el carácter que está en la        |
| 16    |        |          | posición del cursor. Rellena la célula  |
|       |        |          | del carácter con el color actual del    |
|       |        |          | papel.                                  |
+-------+--------+----------+-----------------------------------------+
| &11   | \*DC1  |          | Borra desde el extremo izquierdo de la  |
| 17    |        |          | ventana hasta la posición actual del    |
|       |        |          | cursor inclusive. Rellena las células   |
|       |        |          | afectadas con el color actual del       |
|       |        |          | papel.                                  |
+-------+--------+----------+-----------------------------------------+
| &12   | \*DC2  |          | Borra desde la posición actual del      |
| 18    |        |          | cursor inclusive hasta el extremo       |
|       |        |          | derecho de la ventana. Rellena las      |
|       |        |          | células afectadas con el color actual   |
|       |        |          | del papel.                              |
+-------+--------+----------+-----------------------------------------+
| &13   | \*DC3  |          | Borra desde el principio de la ventana  |
| 19    |        |          | hasta la posición actual del cursor     |
|       |        |          | inclusive. Rellena las células          |
|       |        |          | afectadas con el color actual del       |
|       |        |          | papel.                                  |
+-------+--------+----------+-----------------------------------------+
| &14   | \*DC4  |          | Borra desde la posición actual del      |
| 20    |        |          | cursor inclusive hasta el final de la   |
|       |        |          | ventana. Rellena las células afectadas  |
|       |        |          | con el color actual del papel.          |
+-------+--------+----------+-----------------------------------------+
| &15   | NAK    |          | Inhibe la pantalla de texto, la cual no |
| 21    |        |          | reacciona ante nada que se le envía     |
|       |        |          | mientras no reciba el código ACK (&06   |
|       |        |          | 6)                                      |
+-------+--------+----------+-----------------------------------------+
| &16   | SYN    | 0 a 1    | Se toma el parámetro MOD 2. Opción de   |
| 22    |        |          | transparencia: 0 desactiva, 1 activa.   |
+-------+--------+----------+-----------------------------------------+
| &17   | ETB    | 0 a 3    | Se toma el parámetro MOD 4. Establece   |
| 23    |        |          | el modo de tinta para gráficos:         |
|       |        |          |                                         |
|       |        |          | 0 normal                                |
|       |        |          |                                         |
|       |        |          | 1 XOR                                   |
|       |        |          |                                         |
|       |        |          | 2 AND                                   |
|       |        |          |                                         |
|       |        |          | 3 OR                                    |
+-------+--------+----------+-----------------------------------------+
| &18   | CAN    |          | Intercambia las tintas de pluma y       |
| 24    |        |          | papel.                                  |
+-------+--------+----------+-----------------------------------------+
| &19   | EM     | 0 a 255  | Define la matriz de un carácter         |
| 25    |        |          | definible por el usuario. Equivale a la |
|       |        | 0 a 255  | orden SYMBOL. Lleva nueve parámetros.   |
|       |        |          | El primero es el número del carácter    |
|       |        | 0 a 255  | ocho restantes, el diseño del carácter. |
|       |        |          | El bit más significativo del primer     |
|       |        | 0 a 255  | byte corresponde al punto extremo       |
|       |        |          | superior izquierdo del carácter. El bit |
|       |        | 0 a 255  | menos significativo del último byte     |
|       |        |          | corresponde al punto extremo inferior   |
|       |        | 0 a 255  | derecho del carácter.                   |
|       |        |          |                                         |
|       |        | 0 a 255  |                                         |
|       |        |          |                                         |
|       |        | 0 a 255  |                                         |
|       |        |          |                                         |
|       |        | 0 a 255  |                                         |
+-------+--------+----------+-----------------------------------------+
| &1A   | SUB    | 1 a 80   | Define una ventana. Equivale a la orden |
| 26    |        |          | WINDOW. Los dos primeros parámetros     |
|       |        | 1 a 80   | especifican los bordes izquierdo y      |
|       |        |          | derecho de la ventana; el menor de      |
|       |        | 1 a 25   | ellos se considera definitorio del      |
|       |        |          | borde izquierdo. Los dos últimos        |
|       |        | 1 a 25   | parámetros especifican los bordes       |
|       |        |          | superior e inferior de la ventana; el   |
|       |        |          | menor de ellos se considera definitorio |
|       |        |          | del borde superior.                     |
+-------+--------+----------+-----------------------------------------+
| &1B   | ESC    |          | Sin efecto. Se lo ignora.               |
| 27    |        |          |                                         |
+-------+--------+----------+-----------------------------------------+
| &1C   | FS     | 0 a 15   | Asigna dos colores a una tinta.         |
| 28    |        |          | Equivale a la orden INK. El primer      |
|       |        | 0 a 31   | parámetro (MOD 16) especifica el número |
|       |        |          | de tinta; los dos siguientes (MOD 32),  |
|       |        | 0 a 31   | los colores deseados. (Los valores 27 a |
|       |        |          | 31 no corresponden a colores            |
|       |        |          | definidos.)                             |
+-------+--------+----------+-----------------------------------------+
| &1D   | GS     | 0 a 31   | Asigna dos colores al borde. Equivale a |
| 29    |        |          | la orden BORDER. Los dos parámetros     |
|       |        | 0 a 31   | (MOD 32) especifican los colores. (Los  |
|       |        |          | valores 27 a 31 no corresponden a       |
|       |        |          | colores definidos.)                     |
+-------+--------+----------+-----------------------------------------+
| &1E   | RS     |          | Lleva el cursor al extremo superior     |
| 30    |        |          | izquierdo de la ventana.                |
+-------+--------+----------+-----------------------------------------+
| &1F   | US     | 1 a 80   | Lleva el cursor a la posición           |
| 31    |        |          | especificada dentro de la ventana       |
|       |        | 1 a 25   | actual. Equivale a la orden LOCATE. El  |
|       |        |          | primer parámetro representa la columna; |
|       |        |          | el segundo, la línea.                   |
+-------+--------+----------+-----------------------------------------+

## Parte 2: El sistema operativo

La gestión interna del CPC6128 es realizada en tiempo real por un
sofisticado sistema operativo. El sistema operativo es una especie de
\'guardia de tráfico\' que controla el flujo entre entradas y salidas.

Su función primordial es servir de intermediario (interfaz) entre BASIC
y los circuitos electrónicos. Por ejemplo, cuando el programa exige que
parpadeen las tintas, BASIC entrega al sistema operativo los parámetros
y éste realiza el trabajo.

El sistema operativo de la máquina es lo que se suele denominar
\'firmware\'. Es un programa grabado en ROM y comprende las rutinas en
código de máquina que son invocadas por las órdenes de alto nivel de
BASIC.

Si se siente tentado a modificar el contenido de posiciones de memoria
(con la orden POKE) o a invocar subrutinas del sistema operativo (con
CALL), grabe el programa antes de que sea demasiado tarde.

El firmware del sistema operativo del CPC6128 está descrito en la
publicación SOFT 968 y queda fuera del alcance de este manual.

Si usted piensa programar en código de máquina, debe proveerse de un
programa ensamblador. El DEVPAC de AMSOFT incluye un ensamblador de Z80
reubicable, con editor, desensamblador y monitor.

## Parte 3: Interrupciones

El CPC6128 utiliza ampliamente las interrupciones del Z80 para
proporcionar un sistema operativo que incluye varias características
multitarea, de las que son ejemplo las estructuras AFTER y EVERY
descritas en otro lugar de este manual. El orden de prioridad de los
temporizadores es el siguiente:

-   Break (\[ESC\]\[ESC\]) (detención del programa)

```{=html}
<!-- -->
```
-   Temporizador 3

-   Temporizador 2 (y las tres colas de sonido)

-   Temporizador 1

-   Temporizador 0

Las interrupciones sólo se deben programar después de considerar las
consecuencias de los posibles estados intermedios de las variables en el
momento de la interrupción. La subrutina de interrupción debe evitar
interacciones indeseadas con el estado de las variables del programa
principal.

Las colas de sonidos tienen interrupciones independientes, de igual
nivel de prioridad. Una vez iniciada una interrupción de sonido, ya no
puede ser interrumpida por otra de sonido. Este mecanismo permite que
las rutinas de interrupción de sonido puedan compartir variables sin
estar sujetas a los riesgos mencionados.

Cuando se habilita una interrupción de cola de sonido (con ON SQ GOSUB),
la interrupción se realiza inmediatamente si la cola de sonido del canal
correspondiente no está llena; si lo está, la interrupción se producirá
cuando termine el sonido actual y quede espacio libre en la cola. La
acción de la interrupción inhibe el suceso, de modo que la subrutina
debe ser rehabilitada si se la va a utilizar más tarde.

Las acciones de enviar un sonido y de examinar el estado de la cola
inhiben también la interrupción de sonido.

## Parte 4: Caracteres ASCII y caracteres gráficos en BASIC

### ASCII

En la tabla siguiente se da la relación de los códigos y caracteres
ASCII. Los números están en decimal, octal y hexadecimal. En las
siguientes páginas se ilustra el diseño de los caracteres generados por
el CPC6128.

  ------------------------------------------------------------------------------------------------
  DEC   OCTAL   HEX   Caracteres ASCII     DEC   OCTAL   HEX   ASCII   DEC   OCTAL   HEX   ASCII
  ----- ------- ----- -------------------- ----- ------- ----- ------- ----- ------- ----- -------
  0     000     00    NUL(\[CONTROL\]@)    50    062     32    2       100   144     64    d

  1     001     01    SOH(\[CONTROL\]A)    51    063     33    3       101   145     65    e

  2     002     02    STX(\[CONTROL\]B)    52    064     34    4       102   146     66    f

  3     003     03    ETX(\[CONTROL\]C)    53    065     35    5       103   147     67    g

  4     004     04    EOT(\[CONTROL\]D)    54    066     36    6       104   150     68    h

  5     005     05    ENQ(\[CONTROL\]E)    55    067     37    7       105   151     69    i

  6     006     06    ACK(\[CONTROL\]F)    56    070     38    8       106   152     6A    j

  7     007     07    BRL(\[CONTROL\]G)    57    071     39    9       107   153     6B    k

  8     010     08    BS(\[CONTROL\]H)     58    072     3A    :       108   154     6C    l

  9     011     09    HT(\[CONTROL\]I)     59    073     3B    ;       109   155     6D    m

  10    012     0A    LF(\[CONTROL\]J)     60    074     3C    \<      110   156     6E    n

  11    013     0B    VT(\[CONTROL\]K)     61    075     3D    =       111   157     6F    o

  12    014     0C    FF(\[CONTROL\]L)     62    076     3E    \>      112   160     70    p

  13    015     0D    CR(\[CONTROL\]M)     63    077     3F    ?       113   161     71    q

  14    016     0E    SO(\[CONTROL\]N)     64    100     40    @       114   162     72    r

  15    017     0F    SI(\[CONTROL\]O)     65    101     41    A       115   163     73    s

  16    020     10    DLE(\[CONTROL\]P)    66    102     42    B       116   164     74    t

  17    021     11    DC1(\[CONTROL\]Q)    67    103     43    C       117   165     75    u

  18    022     12    DC2(\[CONTROL\]R)    68    104     44    D       118   166     76    v

  19    023     13    DC3(\[CONTROL\]S)    69    105     45    E       119   167     77    w

  20    024     14    DC4(\[CONTROL\]T)    70    106     46    F       120   170     78    x

  21    025     15    NAK(\[CONTROL\]U)    71    107     47    G       121   171     79    y

  22    026     16    SYN(\[CONTROL\]V)    72    110     48    H       122   172     7A    z

  23    027     17    ETB(\[CONTROL\]W)    73    111     49    I       123   173     7B    {

  24    030     18    CAN(\[CONTROL\]X)    74    112     4A    J       124   174     7C    \|

  25    031     19    EM(\[CONTROL\]Y)     75    113     4B    K       125   175     7D    }

  26    032     1A    SUB(\[CONTROL\]Z)    76    114     4C    L       126   176     7E    \~

  27    033     1B    ESC(\[CONTROL\]\[)   77    115     4D    M                           

  28    034     1C    FS(\[CONTROL\]\\)    78    116     4E    N                           

  29    035     1D    GS(\[CONTROL\]\])    79    117     4F    O                           

  30    036     1E    RS(\[CONTROL\]\^)    80    120     50    P                           

  31    037     1F    US(\[CONTROL\]0)     81    121     51    Q                           

  32    040     20    SP                   82    122     52    R                           

  33    041     21    !                    83    123     53    S                           

  34    042     22    \"                   84    124     54    T                           

  35    043     23    \#                   85    125     55    U                           

  36    044     24    \$                   86    126     56    V                           

  37    045     25    \%                   87    127     57    W                           

  38    046     26    &                    88    130     58    X                           

  39    047     27    \'                   89    131     59    Y                           

  40    050     28    (                    90    132     5A    Z                           

  41    051     29    )                    91    133     5B    \[                          

  42    052     2A    \*                   92    134     5C    \\                          

  43    053     2B    \+                   93    135     5D    \]                          

  44    054     2C    ,                    94    136     5E    \^                          

  45    055     2D    \-                   95    137     5F    \_                          

  46    056     2E    .                    96    140     60    \`                          

  47    057     2F    /                    97    141     61    a                           

  48    060     30    0                    98    142     62    b                           

  49    061     31    1                    99    143     63    c                           
  ------------------------------------------------------------------------------------------------

### Conjunto de caracteres gráficos específicos de la máquina

Los caracteres aquí reproducidos están representados en la matriz
estándar de 8 x 8 en la que se basa la visualización de texto en la
pantalla del CPC6128. Los caracteres definidos por el usuario pueden ser
agrupados para conseguir efectos especiales. Véase la sección
\'Caracteres definidos por el usuario\' en el capítulo \'Cuando usted
guste . . .

![](media/image48.png){width="5.950787401574803in"
height="8.699212598425197in"}

![](media/image49.png){width="6.169291338582677in"
height="10.116535433070867in"}

![](media/image50.png){width="5.8972440944881885in"
height="10.113779527559055in"}

![](media/image51.png){width="5.975196850393701in"
height="10.11259842519685in"}

![](media/image52.png){width="6.422047244094488in"
height="10.101574803149607in"}

![](media/image53.png){width="6.334645669291339in"
height="10.102755905511811in"}

![](media/image54.png){width="6.47007874015748in"
height="10.116535433070867in"}

![](media/image55.png){width="6.438976377952756in"
height="10.104330708661417in"}

![](media/image56.png){width="6.197243000874891in"
height="10.116535433070867in"}

![](media/image57.png){width="6.48976268591426in"
height="9.338188976377953in"}

![](media/image58.png){width="6.4901563867016625in"
height="9.89251968503937in"}

![](media/image59.png){width="6.483463473315836in"
height="4.442518591426071in"}

## Parte 5: Esquemas del teclado

Valores ASCII implícitos generados por las teclas (HEX)

![](media/image60.png){width="6.356299212598425in"
height="2.677952755905512in"}

![](media/image61.png){width="5.124409448818898in" height="2.2in"}

### Códigos expansibles: posiciones y valores implícitos

![](media/image62.png){width="6.47992125984252in"
height="2.7299212598425195in"}

+------------------------+-------------------+------------------------+
| Código                 | Asignación        |                        |
|                        | implícita         |                        |
| expansible             |                   |                        |
+========================+===================+========================+
|                        | Carácter          | Valor ASCII            |
+------------------------+-------------------+------------------------+
| 0(128)                 | 0                 | &30                    |
|                        |                   |                        |
| 1(129)                 | 1                 | &31                    |
|                        |                   |                        |
| 2(130)                 | 2                 | &32                    |
|                        |                   |                        |
| 3(131)                 | 3                 | &33                    |
|                        |                   |                        |
| 4(132)                 | 4                 | &34                    |
|                        |                   |                        |
| 5(133)                 | 5                 | &35                    |
|                        |                   |                        |
| 6(134)                 | 6                 | &36                    |
|                        |                   |                        |
| 7(135)                 | 7                 | &37                    |
|                        |                   |                        |
| 8(136)                 | 8                 | &38                    |
|                        |                   |                        |
| 9(137)                 | 9                 | &39                    |
|                        |                   |                        |
| 10(138)                | .                 | &2E                    |
|                        |                   |                        |
| 11(139)                | \[RETURN\]        | &0D                    |
|                        |                   |                        |
| 12(140)                | RUN\"\[RETURN\]   | &52&55&4E&22&0D        |
+------------------------+-------------------+------------------------+
| Nota. Los caracteres   |                   |                        |
| expansibles 13 a 31    |                   |                        |
| (141 a 159) no tienen  |                   |                        |
| asignada ninguna       |                   |                        |
| cadena de expansión.   |                   |                        |
| Su expansión se puede  |                   |                        |
| definir con la orden   |                   |                        |
| KEY de BASIC, y se los |                   |                        |
| puede asignar a teclas |                   |                        |
| concretas con la Orden |                   |                        |
| KEY DEF.               |                   |                        |
+------------------------+-------------------+------------------------+

### Números de las teclas y los joysticks

![](media/image63.png){width="6.451574803149606in"
height="2.7098425196850395in"}

![](media/image64.png){width="4.800787401574803in"
height="2.1389763779527557in"}

## Parte 6: Sonidos

### Notas y periodos de tono

La tabla siguiente da los valores recomendados para el parámetro
\<periodo de tono\> correspondientes a los tonos y semitonos de las ocho
octavas que puede producir el CPC664.

Las frecuencias generadas no coinciden exactamente con las requeridas
porque el \<periodo de tono\> tiene que ser un número entero. El \'error
relativo\' es el cociente:

[frecuencia requerida-frecuencia generada]{.underline}

frecuencia requerida

expresado en porcentaje.

  ---------------------------------------------------------------------------
  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    
  ------ ------ --------------- ------------- ----------------- -------------
  C      DO     16,352          3822          -0,007%           

  C#     DO#    17,324          3608          0,007%            

  D      RE     18,354          3405          -0,007%           

  D#     RE#    19,445          3214          -0,004%           

  E      MI     20,602          3034          0,009%            

  F      FA     21,827          2863          -0,016%           

  F#     FA#    23,125          2703          0,009%            Octava -4

  G      SOL    24,500          2551          -0,002%           

  G#     SOL#   25,957          2408          0,005%            

  A      LA     27,500          2273          0,012%            

  A#     LA#    29,135          2145          -0,008%           

  B      SI     30,868          2025          0,011%            

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     32,703          1911          -0,007%           

  C#     DO#    34,648          1804          0,007%            

  D      RE     36,708          1703          0,022%            

  D#     RE#    38,891          1607          -0,004%           

  E      MI     41,203          1517          0,009%            

  F      FA     43,654          1432          0,019%            

  F#     FA#    46,249          1351          -0,028%           Octava -3

  G      SOL    48,999          1276          0,037%            

  G#     SOL#   51,913          1204          0,005%            

  A      LA     55,000          1136          -0,032%           

  A#     LA#    58,270          1073          0,039%            

  B      SI     61,735          1012          -0,038%           

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     65,406          956           0,046%            

  C#     DO#    69,296          902           0,007%            

  D      RE     73,416          851           -0,037%           

  D#     RE#    77,782          804           0,058%            

  E      MI     82,407          758           -0,057%           

  F      FA     87,307          716           0,019%            

  F#     FA#    92,499          676           0,046%            Octava -2

  G      SOL    97,999          638           0,037%            

  G#     SOL#   103,826         602           0,005%            

  A      LA     110,000         568           -0,032%           

  A#     LA#    116,541         536           -0,054%           

  B      SI     123,471         506           -0,038%           

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     130,813         478           0,046%            

  C#     DO#    138,591         451           0,007%            

  D      RE     146,832         426           0,081%            

  D#     RE#    155,563         402           0,058%            

  E      MI     164,814         379           -0,057%           

  F      FA     174,614         358           0,019%            

  F#     FA#    184,997         338           0,046%            Octava -1

  G      SOL    195,998         319           0,037%            

  G#     SOL#   207,652         301           0,005%            

  A      LA     220,000         284           -0,032%           

  A#     LA#    233,082         268           -0,054%           

  B      SI     246,942         253           -0,038%           

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     261,626         239           0,046%            

  C#     DO#    277,183         225           -0,214%           

  D      RE     293,665         213           0,081%            

  D#     RE#    311,127         201           0,058%            

  E      MI     329,628         190           0,207%            

  F      FA     349,228         179           0,019%            

  F#     FA#    369,994         169           0,046%            Octava 0

  G      SOL    391,995         159           -0,276%           

  G#     SOL#   415,305         150           -0,327%           

  A      LA     440,000         142           -0,032%           

  A#     LA#    466,164         134           -0,054%           

  B      SI     493,883         127           0,357%            

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     523,251         119           -0,373%           

  C#     DO#    554,365         113           0,229%            

  D      RE     587,330         106           -0,389%           

  D#     RE#    622,254         100           -0,439%           

  E      MI     659,255         95            0,207%            

  F      FA     698,456         89            -0,540%           

  F#     FA#    739,989         84            -0,545%           Octava 1

  G      SOL    783,991         80            0,351%            

  G#     SOL#   830,609         75            -0,327%           

  A      LA     880,000         71            -0,032%           

  A#     LA#    932,328         67            -0,054%           

  B      SI     987,767         63            -0,433%           

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     1046,502        60            0,464%            

  C#     DO#    1108,731        56            -0,658%           

  D      RE     1174,659        53            -0,389%           

  D#     RE#    1244,508        50            -0,439%           

  E      MI     1318,510        47            -0,848%           

  F      FA     1396,913        45            0,578%            

  F#     FA#    1479,978        42            -0,545%           Octava 2

  G      SOL    1567,982        40            0,351%            

  G#     SOL#   1661,219        38            1,002%            

  A      LA     1760,000        36            1,376%            

  A#     LA#    1864,655        34            1,437%            

  B      SI     1975,533        32            1,147%            

                                                                

  NOTA          FRECUENCIA      PERIODO       ERROR RELATIVO    

  C      DO     2093,005        30            0,464%            

  C#     DO#    2217,461        28            -0,658%           

  D      RE     2349,318        27            1,491%            

  D#     RE#    2489,016        25            -0,439%           

  E      MI     2637,020        24            1,262%            

  F      FA     2793,826        22            -1,657%           

  F#     FA#    2959,955        21            -0,545%           Octava 3

  G      SOL    3135,963        20            0,351%            

  G#     SOL#   3322,438        19            1,002%            

  A      LA     3520,000        18            1,376%            

  A#     LA#    3729,310        17            1,437%            

  B      SI     3951,066        16            1,147%            
  ---------------------------------------------------------------------------

Estas frecuencias han sido calculadas a partir de la correspondiente a
la nota LA internacional mediante la siguiente fórmula:

FRECUENCIA=440\*(2\^(OCTAVA+((N-10)/12)))

PERIODO=ROUND(62500/FRECUENCIA)

donde N es 1 para DO, 2 para DO#, etc.

## Parte 7: Mensajes de error de BASIC

**1 Unexpected NEXT**

Se ha encontrado un NEXT que no corresponde a ningún FOR, o bien la
variable mencionada tras NEXT no coincide con la de FOR.

**2 Syntax error**

BASIC no puede entender la línea porque algo en ella no se ajusta a las
reglas de sintaxis del lenguaje.

**3 Unexpected RETURN**

Si ha encontrado una orden RETURN fuera de una subrutina.

**4 DATA exhausted**

Una orden READ ha intentado leer más datos de los incluidos en líneas
DATA.

**5 Improper argument**

Este es un error no específico. Puede haber algo incorrecto en el
argumento de una función o en un parámetro de una orden.

**6 Overflow**

El resultado de una operación aritmética ha sobrepasado los márgenes
aceptables. Si ha ocurrido en un número en punto flotante, el resultado
ha sido mayor que 1.7E+38 (aprox.). También puede haber ocurrido al
intentar convertir un número en punto flotante en un entero con signo de
16 bits.

**7 Memory ful1**

El programa actual o sus variables ocupan demasiado espacio en la
memoria, el anida-miento de la estructura de control es demasiado
profundo (demasiadas órdenes GOSUB, WHILE o FOR anidadas).

La orden MEMORY provoca este error si se intenta situar el límite de la
memoria accesible a BASIC demasiado bajo, o tan alto que sea imposible.
Obsérvese que los ficheros abiertos tienen un tampón dedicado a ellos,
lo que puede restringir los valores correctos de MEMORY.

**8 Line does not exist**

Se ha mencionado un número de línea que no existe en el programa.

**9 Subscript out of range**

Uno de los subíndices mencionados en una lista es demasiado pequeño o
demasiado grande.

**10 Array already dimensioned**

Una de las listas declaradas en una orden DIM ya ha sido dimensionada
antes.

**11 Division by zero**

División por cero, que puede ocurrir en la división de números reales,
en la división entera, en la operación MOD y en la exponenciación.

**12 Invalid direct command**

Se ha intentado dar como orden directa una orden que sólo es válida si
va precedida de un número de línea.

**13 Type mismatch**

Incongruencia de tipos. Un dato es literal cuando tenía que ser
numérico, o viceversa, o se ha introducido un dato no numérico en READ o
INPUT.

**14 String space full**

Se han creado demasiadas cadenas literales y ya no hay espacio
disponible para más, incluso después de reorganizar la memoria.

**15 String too long**

Una cadena literal consta de más de 255 caracteres. Puede haber sido
generada por concatenación de otras.

**16 String expression too complex**

Expresión literal demasiado compleja. Las expresiones literales pueden
generar valores intermedios; cuando el número de estos valores excede de
un límite razonable, se produce este error.

**17 Cannot CONTinue**

No se puede reanudar la ejecución del programa con CONT. Obsérvese que
CONT reanuda el programa después de una instrucción STOP, de
\[ESC\]\[ESC) o de un error, pero a condición de que no se modifique el
programa durante la pausa.

**18 Unknown user function**

Se ha invocado una FN sin la correspondiente DEF FN.

**19 RESUME missing**

Se ha llegado al final del programa mientras se ejecutaba una rutina de
gestión de errores (esto es, una rutina invocada por ON ERROR GOTO).

**20 Unexpected RESUME**

RESUME sólo es válida en una rutina de gestión de errores (esto es, en
una rutina invocada por ON ERROR GOTO).

**21 Direct command found**

Al cargar un fichero se ha encontrado una línea sin número de línea.

**22 Operand missing**

BASIC ha encontrado una expresión incompleta.

**23 Line too long**

BASIC ha convertido a su forma interna una línea y ésta ha resultado ser
demasiado larga.

**24 EOF met**

Se ha intentado leer más allá del final del fichero de entrada.

**25 File type error**

El fichero que se ha leído no es del tipo adecuado. OPENIN sólo puede
abrir ficheros de texto ASCII. Análogamente, LOAD, RUN, etc., solamente
pueden acceder a ficheros creados por SAVE.

**26 NEXT missing**

BASIC ha encontrado un FOR al que no corresponde ningún NEXT. La línea
mencionada tras el mensaje es aquella en la que se encuentra el FOR.

**27 File already open**

Se ha ejecutado una orden OPENIN u OPENOUT sin previamente cerrar el
fichero que estaba abierto.

**28 Unknown command**

BASIC no encuentra un comando externo que corresponda a lo que se ha
escrito tras \|.

**29 WEND missing**

BASIC ha encontrado un WHILE al que no corresponde ningún WEND.

**30 Unexpected WEND**

Se ha encontrado un WEND que no corresponde a ningún WHILE, o bien el
WEND no concuerda con el WHILE del bucle actual.

**31 File not open**

Véase la sección \'Errores de disco\'.

**32 Broken in**

Véase la sección \'Errores de disco\'.

### Errores de disco en AMSDOS

Hay varios errores que pueden producirse con ocasión del manejo de
ficheros en disco. BASIC da a todos ellos el número de ERR 32; no
obstante, DERR contiene información más específica cuando se detecta ese
número de error. Los valores de DERR tienen el siguiente significado:

  -----------------------------------------------------------------------
  Error de  Valor de DERR  Causa del error
  AMSDOS                   
  --------- -------------- ----------------------------------------------
  0         0 o 22         Se ha pulsado \[ESC\].

  14        142(128+14)    El canal no se encuentra en situación
                           correcta.

  15        143(128+15)    Se ha alcanzado el final físico del fichero.

  16        144(128+16)    Orden incorrecta: generalmente nombre de
                           fichero incorrecto.

  17        145(128+17)    El fichero ya existe.

  18        146(128+18)    El fichero no existe.

  19        147(128+19)    El directorio está lleno.

  20        148(128+20)    El disco está lleno.

  21        149(128+21)    Se ha cambiado el disco cuando había ficheros
                           abiertos en él.

  22        150(128+22)    El fichero es de \'sólo lectura'.

  26        154(128+26)    Se ha llegado al final de los datos grabados
                           en el fichero (final lógico del fichero).
  -----------------------------------------------------------------------

Si AMSDOS ya ha informado de un error, el bit 7 de DERR está a 1 y por
lo tanto todos los valores de DERR están desplazados en 128 unidades.

Otros valores generados por DERR proceden del controlador del disco. Su
significado se analiza bit a bit. El bit 6 Siempre está a 1. El bit 7
indica si AMSDOS ha informado del error (según se ha explicado antes).
El significado de los bits es el siguiente:

  ------------------------------------------------------------------------
  Bit   Significado
  ----- ------------------------------------------------------------------
  0     Falta marca de direcciones.

  1     No escribible. El disco está protegido.

  2     Faltan datos. No se puede encontrar el sector.

  3     No hay disco en la unidad, unidad no preparada.

  4     Error de sincronización (velocidad).

  5     Error de datos. Error CRC (comprobación de redundancia cíclica).

  6     Siempre a 1, para indicar que es un error detectado por el
        controlador del disco.

  7     A 1 si AMSDOS ya ha informado del error.
  ------------------------------------------------------------------------

ERR también puede dar el valor 31 si se ha intentado el acceso sin haber
ningún fichero abierto. La forma recomendable de utilizar ERR y DERR
consiste en incluir una instrucción ON ERROR GOTO que invoque una
pequeña subrutina en la cual se compruebe si ERR es 31 o 32; si es 32,
se puede examinar DERR para obtener mayor información sobre la
naturaleza del error. Por ejemplo:

> 10 **ON** **ERROR** **GOTO** 1000
>
> 20 **OPENOUT** \"fichero.asc\"
>
> 30 **WRITE** #9,\"prueba-datos\"
>
> 40 **CLOSEOUT**
>
> 50 **END**
>
> 1000 erramsdos=(**DERR** **AND** &7F): REM mascara para bit 7
>
> 1010 **IF** **ERR**\<31 **THEN** **END**
>
> 1020 **IF** **ERR**=31 **THEN** **PRINT** \"Esta seguro de que ha
> tecleado la linea 20 correctamente?\":**END**
>
> 1030 **IF** erramsdos=20 **THEN** **PRINT** \"Disco lleno; ponga otro
> disco de datos.\":**END**
>
> 1040 **IF** erramsdos=&X01001000 **THEN** **PRINT** \"Inserte un disco
> en la unidad y luego pulse una tecla.\":**WHILE**
> **INKEY**\$=\"\":**WEND**:RESUME
>
> 1050 **END**

## Parte 8: Palabras reservadas de BASIC

A continuación damos la lista de las palabras reservadas para el BASIC
de AMSTRAD CPC6128, las cuales, por consiguiente, no pueden ser
utilizadas como nombres de variables.

ABS, AFTER, AND, ASC, ATN, AUTO

BIN\$, BORDER

CALL, CAT, CHAIN, CHR\$, CINT, CLEAR, CLG, CLOSEIN, CLOSEOUT, CLS, CONT,
COPYCHR\$, COS, CREAL, CURSOR

DATA, DEC\$, DEF, DEFINT, DEFREAL, DEFSTR, DEG, DELETE, DERR, DI, DIM,
DRAW, DRAWR

EDIT, EI , ELSE, END, ENT, ENV, EOF, ERASE, ERL, ERR, ERROR, EVERY, EXP

FILL, FIX, FN, FOR, FRAME, FRE

GOSUB, GOTO, GRAPHICS

HEX\$, HIMEM

IF, INK, INKEY, INKEY\$, INP, INPUT, INSTR, INT

JOY

KEY

LEFT\$, LEN, LET, LINE, LIST, LOAD, LOCATE, LOG, LOG10, LOWER\$

MASK, MAX, MEMORY, MERGE, MID\$, MIN, MOD, MODE, MOVE, MOVER

NEXT, NEW, NOT

ON, ON BREAK, ON ERROR GOTO O, ON SO, OPENIN, OPENOUT, OR, ORIGIN, OUT

PAPER, PEEK, PEN, PI, PLOT, PLOTR, POKE, POS, PRINT

RAD, RAMDOMIZE, READ, RELEASE, REM, REMAIN, RENUM, RESTORE, RESUME,
RETURN, RIGHT\$, RND, ROUND, RUN

SAVE, SGN, SIN, SOUND, SPACE\$, SPC, SPEED, SQ, SOR, STEP, STOP, STR\$,
STRING\$, SWAP, SYMBOL

TAB, TAG, TAGOFF, TAN, TEST, TESTR, THEN, TIME, TO, TROFF, TRON

UNT, UPPER\$, USING

VAL, VPOS

WAIT, WEND, WHILE, WIDTH, WINDOW, WRITE

XOR, XPOS

YPOS

ZONE

## Parte 9: Plantillas

### Pantalla de texto; modo 0 (20 columnas)

![](media/image65.png){width="6.486614173228347in"
height="4.561023622047244in"}

### Pantalla de texto; modo 1 (40 columnas)

![](media/image66.png){width="6.486614173228347in"
height="4.561023622047244in"}

### Pantalla de texto; modo 2 (80 columnas)

![](media/image67.png){width="6.486614173228347in"
height="4.561023622047244in"}

**Nota del revisor (2008)**: Estas plantillas se han generado
directamente desde el CPC, con el siguiente programa en BASIC:

5 **BORDER** 26: **INK** 0,26: **INK** 1, 0

10 **INPUT** \"Modo de pantalla (0 a 2)\";modo

20 **IF** modo\<0 **OR** modo\>2 **THEN** **PRINT**
\"Incorrecto!\":**END**

30 **SYMBOL** 255, 255,128,128,128,128,128,128,128

40 **DIM** columnas(2)

50 columnas(0)=20:columnas(1)=40:columnas(2)=80

60 **MODE** modo

70 **FOR** fila = 1 **TO** 25

80 **FOR** columna = 1 **TO** columnas(modo)

90 **LOCATE** columna, fila

100 **PRINT** **CHR**\$(255);

110 **NEXT** columna

120 **NEXT** fila

130 **MOVE** 0,0:**DRAW** 639,0:**DRAW** 639,399

140 **CALL** &BB18

### Envolventes de sonido/música

![](media/image68.png){width="6.488187882764654in"
height="8.911811023622047in"}

## Parte 10: Conexiones

### Zócalos de entradas y salidas del CPC6128

![](media/image69.png){width="6.368897637795276in"
height="2.0755905511811026in"}

### 

### Zócalo del joystick

VISTO POR DETRÁS

![](media/image70.png){width="3.2417311898512686in"
height="2.3125984251968505in"}

### 

### Zócalo del monitor

![](media/image71.png){width="2.7381889763779528in"
height="1.9279516622922135in"}

### Zócalo estéreo

![](media/image72.png){width="3.8929133858267715in"
height="2.543700787401575in"}

### Zócalo de cinta

![](media/image73.png){width="4.285433070866142in"
height="2.4220461504811897in"}

### Zócalo de expansión

![](media/image74.png){width="6.488975284339458in"
height="3.815353237095363in"}

### Zócalo para la segunda unidad de disco

![](media/image75.png){width="5.160236220472441in"
height="3.7661417322834647in"}

### Zócalo para la impresora

![](media/image76.png){width="4.431102362204724in"
height="2.8307086614173227in"}

## Parte 10: Impresoras

### Interfaz

Al CPC6128 se le puede conectar cualquier impresora que tenga \'interfaz
paralelo tipo \'Centronics\' de 7 bits.

El cable es fácil de construir, pues no tiene que realizar más que una
conexión biunívoca entre el zócalo IMPRESORA del ordenador y el conector
de la impresora. Nótese que en la salida del ordenador hay dos
terminales menos que en el conector de la impresora, con objeto de
permitir la utilización de un conector estándar para circuito impreso.

Los detalles de las patillas del interfaz están ilustrados en la parte 9
de este capítulo.

El cable debe conectar el terminal 1 del ordenador con el 1 de la
impresora, el 19 del ordenador con el 19 de la impresora, etc. Sin
embargo, los terminales 18 y 36 de la impresora no deben ser conectados
al ordenador. Obsérvese que aunque los terminales de la fila superior
del zócalo IMPRESORA del ordenador están numerados del 1 al 17, la
numeración de la fila inferior empieza en el 19, no en el 18, para
mantener la correspondencia con el conector de la impresora.

El ordenador utiliza la señal BUSY (patilla 11) para sincronizar con la
impresora y espera cuando ésta está en OFF-LINE (fuera de línea).

No es necesario enviar a la impresora códigos de preparación; la salida
del ordenador se dirige a la impresora especificando el canal #8.

La salida PRINTER está diseñada para conectar impresoras de matriz de
puntos de bajo costo. No obstante, con el interfaz adecuado, se le
pueden conectar impresoras de margarita, plotters e impresoras de color
por chorro de tinta. La compatibilidad está asegurada por el interfaz
paralelo.

La programación incorporada a la impresora AMSTRAD DMP1 facilita el
funcionamiento en modo gráfico así como los volcados de pantalla.

### Configuración de la impresora

Se ha incluido una función que permite que los caracteres que aparecen
en la pantalla y pueden ser generados por la AMSTRAD DMP1 se escriban en
el papel tal como se los ve en la pantalla, aun cuando los códigos que
tienen en el ordenador no coincidan con los que tienen en la impresora.
La mayor parte de estos signos sólo está disponible cuando en la
impresora se ha seleccionado un idioma distinto del inglés. Por ejemplo:

PRINT CHR\$(&A0)

\^ (en la pantalla)

PRINT #8,CHR\$(&A0)

\^ (también en la impresora)

Esto ocurre así a pesar de que el código del acento circunflejo en la
impresora es &5E. Dicho de otra forma, la programación de la impresora
ha reconocido el &A0 como uno de los códigos que tiene en su tabla de
traducción y lo ha convertido en &5E para escribirlo con la misma forma
que en la pantalla. El código &5E produce el acento circunflejo
cualquiera que sea el idioma seleccionado (no se puede decir lo mismo de
los demás códigos que hay en la tabla de traducción). Los restantes
caracteres de la tabla son los siguientes:

  ---------------------------------------------------------------------------------
  CHR\$    Carácter   Traducción   Signo                                   
           en la      en la        escrito                                 
           pantalla   impresora    en el                                   
                                   papel                                   
  -------- ---------- ------------ --------- -------- --------- ---------- --------
                                   Reino     EE.UU.   Francia   Alemania   España
                                   Unido                                   

  &A0      \^         &5E          \^        \^       \^        \^         \^

  &A2      ¨          &7B          †         †        †         †          ¨

  &A3      Pt         &23          £         \#       \#        \#         Pt

  &A6      §          &40          †         †        †         §          †

  &AE      ¿          &5D          †         †        †         †          ¿

  &AF      ¡          &5B          †         †        †         †          ¡
  ---------------------------------------------------------------------------------

† Véase la página 18 del manual de la DMP1.

La tabla anterior es un extracto de las traducciones implícitas, que se
pueden modificar a voluntad. Véase el manual del firmware (SOFT 968)
para más detalles.

## Parte 12: Joysticks

El ordenador puede funcionar con uno o dos joysticks. La máquina los
considera como parte del teclado, y por consiguiente su estado se puede
determinar con INKEY e INKEY\$.

Nótese que en la mayor parte de los casos, el botón principal de disparo
del joystick es interpretado como \'DISP.2\' por el CPC6128.

Las funciones JOY(0) y JOY(1) permiten inspeccionar directamente los dos
joysticks. Cada una de estas funciones genera un resultado,
interpretable bit a bit, que informa de la situación de los
interruptores del joystick en el momento en que se realizó la última
comprobación del teclado.

La tabla siguiente indica los valores generados por los dos joysticks.
Además de los números de la función JOY, se incluyen los números que se
deben utilizar en instrucciones que llevan como parámetro los números de
las teclas (tales como INKEY y KEY DEF).

  -------------------------------------------------------------------------
  Estado      Función JOY             Números de              
                                      tecla                   
  ----------- ----------- ----------- ----------- ----------- -------------
              Bit que     Valor       Primer      Segundo     Tecla
              está a 1    generado    joystick    joystick    equivalente

  Arriba      0           1           72          48          \'6'

  Abajo       1           2           73          49          \'5'

  Izquierda   2           4           74          50          \'R'

  Derecha     3           8           75          51          \'T'

  Disparo 2   4           16          76          52          \'G'

  Disparo 1   5           32          77          53          \'F'
  -------------------------------------------------------------------------

Nótese que cuando se generan los valores correspondientes al segundo
joystick, el ordenador no puede saber si esos valores han sido generados
por el joystick o por las teclas equivalentes (última columna de la
tabla anterior). Esto representa que se puede utilizar el teclado como
sustituto del segundo joystick.

## Parte 13: Organización de los discos

El BIOS maneja tres formatos de disco diferentes: formato SISTEMA,
formato SÓLO DATOS y formato IBM. AMSDOS detecta automáticamente el
formato cada vez que accede a un disco en el que no haya ficheros
abiertos. Para permitir esta detección automática, en cada formato los
sectores se numeran de forma diferente.

Los discos de 3 pulgadas tienen dos caras utilizables, aunque no al
mismo tiempo. Cada cara puede haber sido inicializada con un formato
distinto.

### Común a todos los formatos:

Una sola cara (las dos caras del disco de 3 pulgadas se tratan por
separado).

-   Capacidad física de cada sector: 512 bytes.

```{=html}
<!-- -->
```
-   40 pistas, numeradas del 0 al 39.

-   Tamaño de bloque de CP/M: 1024 bytes.

-   Directorio de 64 reseñas.

### Formato SISTEMA

-   9 sectores por pista, numerados del &41 al &49.

```{=html}
<!-- -->
```
-   2 pistas reservadas.

Es el formato principal, ya que CP/M sólo puede ser cargado con un disco
que tenga este formato. CP/M 2.2 exige además que se inserte en la
unidad un disco con formato de sistema para los arranques iniciales. Las
pistas reservadas se utilizan de la siguiente forma:

  -----------------------------------------------------------------------
                          CP/M 2.2                CP/M Plus
  ----------------------- ----------------------- -----------------------
  Pista 0 sector &41      sector de carga         Sector de carga
                          automática              automática para CP/M
                                                  Plus

  Pista 0 sector &42      sector de configuración no utilizadas

  Pista 0 sectores &43 a  no utilizadas           
  &47                                             

  Pista 0 sectores &48 a  CPC y BDOS              
  &49                                             

  Pista 1 sectores &41 a                          
  &49                                             
  -----------------------------------------------------------------------

Nótese que el formato COMERCIAL es una versión especial del formato
SISTEMA en la que no se graban las pistas reservadas. Este es el formato
en que se graban los programas que se venden en el comercio.

### Formato SÓLO DATOS

-   9 sectores por pista numerados del &C1 al &C9.

```{=html}
<!-- -->
```
-   Ninguna pista reservada.

Este formato está diseñado para su desarrollo en el futuro. No se
recomienda utilizarlo con CP/M 2.2, pues no permite cargar el sistema
operativo. No obstante, si sólo se va a utilizar el disco con AMSDOS O
CP/M Plus, se lo puede inicializar con este formato para disponer de más
espacio.

### Formato IBM (sólo en CP/M 2.2)

-   8 sectores numerados del &1 al &8.

```{=html}
<!-- -->
```
-   1 pista reservada.

Este formato coincide con el formato de una sola cara utilizado por el
CP/M del IBM PC. El 6128 puede leer y escribir en discos de este
formato, pero no puede crearlos ni copiarlos.

## Parte 14: Ampliaciones del sistema residentes (RSX)

En el capítulo 5, al hablar de AMSDOS, ya hemos mencionado las \'órdenes
externas\'. En esencia, una orden externa es una forma de ampliar el
repertorio de BASIC añadiéndole instrucciones nuevas, todas las cuales
van precedidas del signo . Las rutinas que llevan a cabo las acciones de
las órdenes externas de AMSDOS están grabadas en la ROM; el ordenador
realiza todas las operaciones necesarias para hacer accesibles estas
órdenes cuando entra en BASIC.

Pero también es posible incorporar nuevas órdenes externas (cuando BASIC
está ya activo) cargando las instrucciones de código de máquina
adecuadas en la RAM. Tales órdenes externas son las \'ampliaciones del
sistema residentes\' (RSX) y actúan exactamente igual que las basadas en
la ROM. Las RSX han de ser cargadas desde el disco (o la cinta) cada vez
que se entra en BASIC. La aplicación habitual de la RSX es el control de
periféricos \'inteligentes\', tales como lapiceros ópticos o
sintetizadores de voz.

En el capítulo 8 se explica cómo utilizar las RSX para acceder al
segundo banco de 64K de memoria del 6128.

## Parte 15: Memoria

El CPC6128 dispone de 128K de RAM y 48K de ROM. Esta memoria es
utilizable por BASIC 1.1 según se indica en la figura siguiente. El
primer banco de 64K de RAM está dividido nominalmente en cuatro bloques
(de 16K cada uno), numerados del 0 al 3. La pantalla utiliza el bloque
3; la zona superior del bloque 2 está dedicada a las variables de
sistema, según se muestra en la figura.

![](media/image77.png){width="6.486219378827647in"
height="3.897244094488189in"}

Mapa de memoria para BASIC 1.1

Los caracteres definidos por el usuario están inicialmente
inmediatamente por encima de HIMEM. Este valor se puede modificar
mediante una orden MEMORY; además se reduce en 4K automáticamente para
crear un tampón cada vez que se abre un fichero. El número de caracteres
definibles por el usuario (controlado por la orden SYMBOL AFTER de
BASIC) sólo se puede modificar si HIMEM no ha variado desde la última
vez que aquél fue establecido (o si en esa ocasión se estableció en
cero, con SYMBOL AFTER 256). Cuando se entra en BASIC, el número de
caracteres definibles por el usuario se establece como si se hubiera
ejecutado la orden SYMBOL AFTER 240.

Por consiguiente, antes de cambiar permanentemente HIMEM, es prudente
reducir a cero la zona de memoria dedicada a los caracteres definibles;
después se modifica HIMEM y finalmente se restablece la zona de
caracteres definibles al tamaño deseado. De esta manera los siguientes
programas podrán ejecutar nuevas órdenes SYMBOL AFTER sin problemas.

El siguiente ejemplo ilustra este método, aplicado a la carga de una
RSX:

> 100 **SYMBOL** **AFTER** 256 \' anular memoria para caracteres
> definibles por el usuario
>
> 110 direccionrsx=**HIMEM**-longitudrsx
>
> 120 **MEMORY** direccionrsx-1
>
> 130 **LOAD** \"codigorsx\",direccionrsx
>
> 140 **CALL** direccionrsx \' inicializar rsx
>
> 150 **SYMBOL** **AFTER** 140 \' restablecer espacio para caracteres
> definibles

![](media/image78.png){width="6.486614173228347in"
height="3.745275590551181in"}

### Otras entradas y Salidas

La mayor parte de las direcciones de puertas de entrada/salida (E/ S)
está reservada por el ordenador. En particular, las direcciones
inferiores a &7FFF no se deben utilizar nunca.

Está previsto que la parte de la dirección representada por A0-A7
refleje el tipo de dispositivo externo de E/S, y que las líneas de
dirección A8 y A9 puedan ser decodificadas para seleccionar registros
dentro del dispositivo de E/S. De las restantes líneas, sólo A10 puede
ser decodificada (a nivel \'bajo'); las líneas A11 a A15 están todas a
nivel \'alto'. Así, los registros de los dispositivos se pueden
direccionar como &F8??, &F9??, &FA?? y &FB??, donde ?? puede estar entre
DC y FF para los interfaces de comunicación y entre E0 y FE para otros
periféricos.

Nótese que se deben utilizar instrucciones del Z80 que pongan el
registro B en la mitad superior del bus de direcciones (A15-A8).

### Memorias ROM adicionales

El sistema operativo está preparado para seleccionar ROMs adicionales en
lugar de parte de la ROM interna. La lógica de gestión de direcciones y
de selección de bancos estará en un módulo conectado al bus de
expansión, pero todas las señales necesarias están en el corrector de
expansión.

### Parte 16: Emulador de consola de CP/M Plus

En la parte 1 de este capítulo hemos dado una tabla de caracteres de
control con la descripción de sus efectos. Tales efectos son los que se
producen cuando se envían los caracteres a la pantalla de texto desde
BASIC o desde CP/M 2.2. Estas acciones han sido elegidas con los
criterios de sencillez y de conseguir que ilustren algunas de las
funciones disponibles en el bloque de \'Text VDU' (pantalla de texto)
del firmware. Estas funciones son peculiares de los ordenadores Amstrad,
y por lo tanto los programas deben ser amoldados a ellas.

En el contexto de las aplicaciones comerciales que se programan para
CP/M Plus, es normal esperar que los ordenadores dispongan de ciertas
funciones estándar de control de la pantalla de texto, de modo que los
programas sean fácilmente \"trasladables\" de una máquina a otra. La
implementación de CP/M Plus en el CPC6128 incluye un emulador de consola
que proporciona funciones de control similares a las del terminal Zenith
Z19/Z29. El procedimiento de instalación de los programas escritos para
CP/M Plus incluirá normalmente una opción para terminales de este tipo.

Entre las funciones incorporadas en el emulador de consola de CP/M Plus
se encuentran muchas de las antes ofrecidas en el grupo \'Text VDU' del
firmware, aunque con diferentes códigos de control. Pero en CP/M Plus se
dispone de un número considerable de operaciones nuevas y más complejas.

Los caracteres del margen de &20 a &FF se exhiben en la pantalla en la
posición actual del cursor. Además, si el cursor no está en la última
columna, se lo desplaza una posición a la derecha; si el cursor está en
la última columna y está activada la continuidad de las líneas, se lo
coloca en la primera columna de la línea siguiente, desplazando la
pantalla hacia arriba si es necesario.

Los caracteres del margen de &00 a &1F se interpretan como códigos de
control, según la siguiente tabla:

  -----------------------------------------------------------------------
  &07    BEL     Produce un pitido.
  ------ ------- --------------------------------------------------------
  &08    BS      Retroceso del cursor. Mueve el cursor una posición hacia
                 la izquierda. Si el cursor está en la primera columna
                 (pero no en la primera fila) y está activada la
                 continuidad de las líneas, se lo coloca en la última
                 columna de la fila anterior.

  &0A    LF      Avance de línea. Se baja el cursor a la línea siguiente,
                 desplazando la pantalla hacia arriba si es necesario.

  &0D    CR      Retorno del carro. Lleva el cursor a la primera columna
                 de la fila actual.
  -----------------------------------------------------------------------

Se ignoran todos los demás códigos de control.

El emulador de consola reconoce las siguientes secuencias de \'escape'.
Todos los demás caracteres son exhibidos en la pantalla (con el
consiguiente avance del cursor) aunque vayan precedidos del código de
escape. Gracias a esta característica es posible enviar a la pantalla
los caracteres visibles correspondientes a los códigos de control del
&00 al &1F. (Obsérvese, no obstante, que en muchas aplicaciones se
reinterpreta el código de control &09 (TAB) para que signifique cierto
número de espacios; en tales casos la secuencia \[ESC\]\[TAB\] no
visualizará el carácter &09.)

+--------------+-------------------------------------------------------+
| \[ESC\]0     | Desactiva la línea indicadora de estado. Los mensajes |
|              | del sistema de disco aparecen en la pantalla          |
|              | principal, en la cual puede utilizar también la       |
|              | última línea.                                         |
+==============+=======================================================+
| \[ESC\]1     | Activa la línea de estado. Los mensajes del sistema   |
|              | de disco aparecen en la última línea de la pantalla.  |
+--------------+-------------------------------------------------------+
| \            | Selecciona un juego de caracteres (véase la parte 16  |
| [ESC\]2\<n\> | de este capítulo). \<n\> es el parámetro selector de  |
|              | idioma, que se enmascara con &07. La acción consiste  |
|              | en intercambiar ciertas matrices de caracteres del    |
|              | margen de &20 a &7F con otras del margen de &80 a     |
|              | &FF; es muy similar a la que se realiza con           |
|              | impresoras que disponen de varios juegos de           |
|              | caracteres seleccionables por programa.               |
|              |                                                       |
|              | \<n\>=0 EE.UU.                                        |
|              |                                                       |
|              | \<n\>=1 Francia                                       |
|              |                                                       |
|              | \<n\>=2 Alemania                                      |
|              |                                                       |
|              | \<n\>=3 Reino Unido                                   |
|              |                                                       |
|              | \<n\>=4 Dinamarca                                     |
|              |                                                       |
|              | \<n\>=5 Suecia                                        |
|              |                                                       |
|              | \<n\>=6 Italia                                        |
|              |                                                       |
|              | \<n\>=7 España                                        |
+--------------+-------------------------------------------------------+
| \            | Selecciona el modo de pantalla. \<m\>=modo+&20. El    |
| [ESC\]3\<m\> | valor se enmascara con &3 para limitarlo al margen de |
|              | 0 a 2. El modo 3 se ignora. Se borra la pantalla,     |
|              | pero no se modifica la posición del cursor.           |
+--------------+-------------------------------------------------------+
| \[ESC\]A     | Cursor arriba. Si ya está en la primera línea, ningún |
|              | efecto.                                               |
+--------------+-------------------------------------------------------+
| \[ESC\]B     | Cursor abajo. Si ya está en la última línea, ningún   |
|              | efecto.                                               |
+--------------+-------------------------------------------------------+
| \[ESC\]C     | Cursor a la derecha. Si ya está en la última columna, |
|              | ningún efecto.                                        |
+--------------+-------------------------------------------------------+
| \[ESC\]D     | Cursor a la izquierda. Si ya está en la primera       |
|              | columna, ningún efecto.                               |
+--------------+-------------------------------------------------------+
| \[ESC\]E     | Borrar página. La posición del cursor no se modifica. |
|              | Esta secuencia borra la página entera, aunque se haya |
|              | seleccionado el modo de 24x80. (Hay otros códigos de  |
|              | escape que sólo afectan al área 24x80 cuando está     |
|              | seleccionado este modo.)                              |
+--------------+-------------------------------------------------------+
| \[ESC\]H     | Cursor a la posición inicial. Lleva el cursor a la    |
|              | primera columna de la primera fila.                   |
+--------------+-------------------------------------------------------+
| \[ESC\]I     | Retroceso de línea. Sube el cursor a la línea         |
|              | anterior, desplazando la pantalla hacia abajo si es   |
|              | necesario.                                            |
+--------------+-------------------------------------------------------+
| \[ESC\]J     | Borrar hasta el final de la página (incluido el       |
|              | carácter que está en la posición del cursor). No se   |
|              | modifica la posición del cursor.                      |
+--------------+-------------------------------------------------------+
| \[ESC\]K     | Borrar hasta el final de la línea (incluido el        |
|              | carácter que está en la posición del cursor). No se   |
|              | modifica la posición del cursor.                      |
+--------------+-------------------------------------------------------+
| \[ESC\]L     | Insertar línea. La línea en la que está el cursor y   |
|              | todas las siguientes se desplazan hacia abajo; se     |
|              | borra la línea del cursor; la posición de éste no se  |
|              | modifica.                                             |
+--------------+-------------------------------------------------------+
| \[ESC\]M     | Suprimir línea. La línea en la que está el cursor se  |
|              | pierde; todas las siguientes se desplazan hacia       |
|              | arriba; se borra la última línea; la posición del     |
|              | cursor no se modifica.                                |
+--------------+-------------------------------------------------------+
| \[ESC\]N     | Suprimir carácter. Todos los caracteres que están a   |
|              | la derecha del cursor, en su misma línea, se          |
|              | desplazan una posición hacia la izquierda. El         |
|              | carácter de la última columna queda en blanco.        |
+--------------+-------------------------------------------------------+
| \[ESC\       | Lleva el cursor a la posición especificada. Si esa    |
| ]Y\<l\>\<c\> | posición sobrepasa algún borde de la pantalla, el     |
|              | cursor se queda en el borde correspondiente.          |
|              | \<l\>=línea+&20; \<c\>=columna+&20. El extremo        |
|              | superior izquierdo es línea 0, columna 0.             |
+--------------+-------------------------------------------------------+
| \[           | Establece color de pluma. Afecta a todos los          |
| ESC\]b\<pc\> | caracteres presentes en la pantalla. El parámetro de  |
|              | color, \<pc\>, se enmascara con &3F y luego se lo     |
|              | interpreta como tres números de 2 bits que            |
|              | especifican las intensidades de los tres colores      |
|              | primarios: los bits 0 y 1 para el azul, los bits 2 y  |
|              | 3 para el rojo y los bits 4 y 5 para el verde. El     |
|              | 6128 proporciona tres niveles de intensidad, que se   |
|              | especifican de la siguiente forma:                    |
+--------------+-------------------------------------------------------+
| \[           | Establece color de fondo. Afecta tanto al fondo como  |
| ESC\]c\<pc\> | al borde de la pantalla. Los colores se especifican   |
|              | como en la secuencia anterior.                        |
+--------------+-------------------------------------------------------+
| \[ESC\]d     | Borrar desde el principio de la página (hasta la      |
|              | posición del cursor inclusive). No se modifica la     |
|              | posición del cursor.                                  |
+--------------+-------------------------------------------------------+
| \[ESC\]e     | Activa el cursor. Para evitar el molesto parpadeo que |
|              | de otra forma se produciría, el cursor está inhibido  |
|              | durante la escritura normal del texto y sólo se lo    |
|              | activa una décima de segundo después de escribir el   |
|              | último carácter.                                      |
+--------------+-------------------------------------------------------+
| \[ESC\]f     | Inhibe el cursor.                                     |
+--------------+-------------------------------------------------------+
| \[ESC\]j     | Almacenar la posición del cursor.                     |
+--------------+-------------------------------------------------------+
| \[ESC\]k     | Restablecer la posición del cursor almacenada por     |
|              | \[ESC\]j.                                             |
+--------------+-------------------------------------------------------+
| \[ESC\]l     | Borrar línea. No se modifica la posición del cursor.  |
+--------------+-------------------------------------------------------+
| \[ESC\]o     | Borrar desde el principio de la línea (hasta la       |
|              | posición del cursor inclusive). No se modifica la     |
|              | posición del cursor.                                  |
+--------------+-------------------------------------------------------+
| \[ESC\]p     | Activar el modo de imagen invertida (\'video          |
|              | inverso'). Los caracteres visibles se escriben con    |
|              | los colores de fondo y pluma invertidos.              |
+--------------+-------------------------------------------------------+
| \[ESC\]q     | Desactivar el modo de imagen invertida.               |
+--------------+-------------------------------------------------------+
| \[ESC\]r     | Activar el modo de subrayado. (No disponible en el    |
|              | CPC6128.)                                             |
+--------------+-------------------------------------------------------+
| \[ESC\]u     | Desactivar el modo de subrayado. (No disponible en el |
|              | CPC6128.)                                             |
+--------------+-------------------------------------------------------+
| \[ESC\]v     | Activa la continuidad de las líneas. Cuando los       |
|              | caracteres enviados a la pantalla sobrepasan la       |
|              | última columna de una línea, siguen apareciendo al    |
|              | principio de la línea siguiente.                      |
+--------------+-------------------------------------------------------+
| \[ESC\]w     | Desactiva la continuidad de las líneas. Cuando los    |
|              | caracteres enviados a la pantalla sobrepasan la       |
|              | última columna de una línea, se los ignora.           |
+--------------+-------------------------------------------------------+
| \[ESC\]x     | Activa el modo 24x80. Algunos programas requieren la  |
|              | pantalla estándar de 24 filas por 80 columnas. Esta   |
|              | secuencia selecciona esa pantalla, independientemente |
|              | de cuál sea el tamaño total de la pantalla (que       |
|              | depende de la máquina), del país y de si la línea de  |
|              | estado está activada o desactivada. Se borra la       |
|              | pantalla.                                             |
+--------------+-------------------------------------------------------+
| \[ESC\]y     | Desactiva el modo 24x80. Se borra la pantalla.        |
+--------------+-------------------------------------------------------+

### Parte 17: Juego de caracteres de CP / M Plus

En la parte 10 de este capítulo hemos descrito una tabla de traducción
para impresoras. El fin de esta tabla es convertir algunos caracteres
del juego de BASIC y CP/M 2.2 a una forma tal que puedan ser escritos
por la impresora cuando en ella se ha realizado cierta selección de
idioma. Esta función está limitada por el hecho de que pocos de los
caracteres internacionales de las impresoras aparecen en el juego de
caracteres de BASIC.

Aunque este método sigue funcionando en CP/M Plus, se lo ha ampliado
hasta permitir una correspondencia casi absoluta entre los caracteres
visibles en la pantalla y los de la impresora. (El carácter visible que
falta es el signo monetario sueco, que debería figurar en lugar de
\'\$'.) La distribución de caracteres por idiomas es la siguiente:

![](media/image79.png){width="4.104724409448819in"
height="3.017321741032371in"}

Juego internacional de caracteres de CP/M Plus

Para adaptar la máquina a un idioma determinado se debe hacer lo
siguiente:

1.  Seleccionar el idioma en la impresora (generalmente mediante
    microconmutadores basculantes, aunque en algunas impresoras la
    selección se puede realizar por programa enviándole códigos de
    control).

```{=html}
<!-- -->
```
1.  Seleccionar el juego de caracteres deseado, bien mediante la orden
    transitoria

> LANGUAGE \<n\>
>
> bien enviando la secuencia
>
> \[ESC\]2\<n\>
>
> al emulador de consola.

En la práctica, esta inicialización se suele programar en el
procedimiento PROFILE.SUB mediante las funciones LANGUAGE y SETKEYS. El
CP/M Plus se suministra con el juego de caracteres número 0 (EE.UU.)
preseleccionado, ya que en la tecla del \'3' está grabado el signo \'#'.

### Juegos de caracteres de 7 bits

Por útil que sea esta posibilidad de seleccionar juegos de caracteres,
debemos resaltar que los caracteres estándar (EE.UU.) reemplazados por
caracteres de otros idiomas dejan de ser visualizables. Esto es
inevitable cuando se manejan juegos de caracteres de 7 bits.
Prácticamente todos los programas disponibles para CP/M Plus (incluidos
casi todos los programas de ayuda y los procesadores de texto) trabajan
con un juego de caracteres de 7 bits. En el Reino Unido se acepta que el
signo \'#' desaparezca para ser sustituido por el \'£', no sólo en
proceso de textos, donde es deseable, sino también en los listados de
programas, v.g. LIST £8, donde no lo es. Con el tiempo el usuario llega
a habituarse a hacer mentalmente la transformación de un signo a otro.

Pero en otros idiomas los cambios son más perturbadores. Los signos
nuevos reemplazan caracteres tan necesarios como la barra vertical y los
corchetes. A pesar de la mejora de la legibilidad de los textos gracias
a los acentos, en las situaciones en las que el programa requiere la
barra y los corchetes (por ejemplo, DIR \[ALL\] la legibilidad queda
notablemente reducida. Lo mismo se puede decir de la facilidad de
escritura, si se han cambiado algunas teclas para adaptarlas al nuevo
juego de caracteres.

Recuerde que los programas trabajan con códigos ASCII y son totalmente
indiferentes a la forma que puedan tener los caracteres en la pantalla.
Lo que ocurre con los juegos de caracteres de 7 bits es, sencillamente,
que no hay códigos suficientes para cubrir todas las necesidades.

### Juegos de caracteres de 8 bits

El juego de caracteres de BASIC tiene 256 símbolos diferentes; los
códigos del 128 al 255 (&80 a &FF) representan diversos símbolos
gráficos de aplicación en programas de juegos e informática doméstica.
En CP/M Plus también hay 256 caracteres, pero los 128 últimos son
distintos de los de BASIC; están diseñados para aplicaciones comerciales
y para la generación de juegos específicos por idiomas:

![](media/image80.png){width="6.486614173228347in"
height="2.533464566929134in"}

Juego de caracteres estándar (EE.UU.) de CP/M Plus

Los programas capaces de trabajar con juegos de caracteres de 8 bits
disponen de este juego completo y podrán, no sólo dibujar recuadros,
sino también acceder a los caracteres especiales de todos los idiomas,
sin encontrar los problemas que describíamos en la sección anterior.

En la actualidad hay muy pocos programas preparados para trabajar con
juegos de caracteres de 8 bits. Los caracteres de los márgenes de 0 a 31
y de 128 a 255 tendrán el aspecto que se muestra en la figura anterior
solamente en la pantalla. En la impresora serán distintos, pues los
fabricantes de impresoras tienen sus propias ideas sobre el diseño de
juegos de caracteres.

